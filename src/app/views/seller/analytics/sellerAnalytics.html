<div ng-controller="SellerAnalyticsController as vm" ng-init="vm.init()">
  <header class="header">
    <div class="container">
      <div class="header__content">
        <a ui-sref="buyerHome" class="logo">
          <img src="https://media.istockphoto.com/id/1332607862/vector/car-rental-logo-template-design.jpg?s=612x612&w=0&k=20&c=Z7HXnGff9rQIvLWgrYT0E8oge2NMlLg5v0ZB1dCe4zM=" alt="RentO Logo">
        </a>
        <nav class="nav">
          <ul class="nav__list">
            <li><a ui-sref="sellerDashboard" class="nav__link">Dashboard</a></li>
            <li><a ui-sref="sellerListings" class="nav__link">My Listings</a></li>
            <li><a ui-sref="sellerBookings" class="nav__link">Bookings</a></li>
            <li><a ui-sref="conversations" class="nav__link">Messages</a></li>
            <li><a ui-sref="sellerAnalytics" class="nav__link active">Reports</a></li>
          </ul>
        </nav>
        <div class="header__profile">
          <a ui-sref="userDashboard" class="profile__link">
            <img src="https://photosking.net/wp-content/uploads/2024/05/no-dp-pic_23.webp" alt="Profile" class="profile__icon">
            <span class="profile__text">Profile</span>
          </a>
        </div>
      </div>
    </div>
  </header>

  <main class="reports">
    <div class="container">
      <h1 class="page-title">Seller Analytics Reports</h1>
      
      <!-- Stats Section: Key Metrics -->
      <section class="stats-section">
        <div class="chart-card">
          <p class="chart-description">Time from Listing to First Booking (days)</p>
          <div class="stat-number">{{ vm.stats.listingToFirstBooking }}</div>
        </div>
        <div class="chart-card">
          <p class="chart-description">Average Booking Duration (days)</p>
          <div class="stat-number">{{ vm.stats.avgBookingDuration }}</div>
        </div>
        <div class="chart-card">
          <p class="chart-description">Most Queried Vehicle</p>
          <div class="stat-number">{{ vm.stats.mostQueriedVehicle.model }} ({{ vm.stats.mostQueriedVehicle.queryCount }} queries)</div>
        </div>
        <div class="chart-card">
          <p class="chart-description">Total Revenue</p>
          <div class="stat-number">Rs {{ vm.stats.totalRevenue }}</div>
        </div>
      </section>
      
      <!-- Outstation Stats Section -->
      <section class="stats-section outstation-stats">
        <div class="chart-card full-width">
          <p class="chart-description">Outstation vs Local Stats</p>
          <p>Outstation Bookings: {{ vm.stats.outstationStats.outstationCount }} ({{ (vm.stats.outstationStats.outstationCount / vm.stats.totalBookings * 100) | number:1 }}%)</p>
          <p>Local Bookings: {{ vm.stats.outstationStats.localCount }} ({{ (vm.stats.outstationStats.localCount / vm.stats.totalBookings * 100) | number:1 }}%)</p>
          <p>Outstation Revenue: Rs {{ vm.stats.outstationStats.outstationRevenue }}</p>
          <p>Local Revenue: Rs {{ vm.stats.outstationStats.localRevenue }}</p>
        </div>
      </section>
      
      <!-- Charts Section: Primary Analytics -->
      <section class="charts-section">
        <div class="chart-card">
          <p class="calc-details">
            ?<span class="tooltiptext">Calculation: Count of listings per location.</span>
          </p>
          <p class="chart-description">Most Active Location for Your Listings</p>
          <canvas id="activeLocationChart"></canvas>
        </div>
        <div class="chart-card">
          <p class="calc-details">
            ?<span class="tooltiptext">Calculation: Compare your average minimum rental price to the market average.</span>
          </p>
          <p class="chart-description">Price Competitiveness</p>
          <canvas id="priceCompetitivenessChart"></canvas>
        </div>
        <div class="chart-card">
          <p class="calc-details">
            ?<span class="tooltiptext">Calculation: Vehicles ranked by number of bids received.</span>
          </p>
          <p class="chart-description">Most Bidded Vehicles</p>
          <canvas id="mostBiddedChart"></canvas>
        </div>
        <div class="chart-card">
          <p class="calc-details">
            ?<span class="tooltiptext">Calculation: (Total Bookings / Total Bids) x 100.</span>
          </p>
          <p class="chart-description">Bid-to-Booking Conversion Rate</p>
          <canvas id="conversionRateChart"></canvas>
        </div>
        <div class="chart-card">
          <p class="calc-details">
            ?<span class="tooltiptext">Calculation: Average bid amount per vehicle vs. its minimum rental price.</span>
          </p>
          <p class="chart-description">Avg Bid Amount vs. Minimum Rental Price</p>
          <canvas id="bidVsRentalChart"></canvas>
        </div>
        <div class="chart-card">
          <p class="calc-details">
            ?<span class="tooltiptext">Calculation: Vehicle with the highest booking count.</span>
          </p>
          <p class="chart-description">Most Rented Vehicle</p>
          <canvas id="mostRentedChart"></canvas>
        </div>
      </section>
      
      <!-- Charts Section: Outstation Analytics -->
      <section class="charts-section">
        
        <div class="chart-card">
          <p class="calc-details">
            ?<span class="tooltiptext">Calculation: Average booking duration for local vs. outstation bookings.</span>
          </p>
          <p class="chart-description">Avg Booking Duration (Local vs. Outstation)</p>
          <canvas id="avgBookingDurationByTypeChart"></canvas>
        </div>
        <div class="chart-card">
          <p class="calc-details">
            ?<span class="tooltiptext">Calculation: Average bid amount for local vs. outstation bids.</span>
          </p>
          <p class="chart-description">Avg Bid Amount (Local vs. Outstation)</p>
          <canvas id="avgBidAmountByTypeChart"></canvas>
        </div>
      </section>
      
      <!-- Refresh Button -->
      <div class="refresh-section">
        <button ng-click="vm.loadAnalytics()" class="refresh-button">Refresh Analytics</button>
      </div>
    </div>
  </main>
</div>
