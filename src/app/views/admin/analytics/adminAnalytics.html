<body>
  <div ng-controller="AdminAnalyticsController as vm" ng-init="vm.init()">
    <!-- Navbar using uib-navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a ui-sref="adminDashboard" class="navbar-brand">
            <img src="https://media.istockphoto.com/id/1332607862/vector/car-rental-logo-template-design.jpg?s=612x612&w=0&k=20&c=Z7HXnGff9rQIvLWgrYT0E8oge2NMlLg5v0ZB1dCe4zM=" alt="RentO Logo" height="40">
          </a>
          <button type="button" class="navbar-toggle" ng-click="vm.isCollapsed = !vm.isCollapsed">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div uib-collapse="vm.isCollapsed" class="navbar-collapse">
          <ul class="nav navbar-nav">
            <li ng-class="{active: vm.activeState === 'superAdmin'}">
              <a ui-sref="superAdmin">Dashboard</a>
            </li>
            <li ng-class="{active: vm.activeState === 'adminAnalytics'}">
              <a ui-sref="adminAnalytics">Analytics</a>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li uib-dropdown>
              <a href uib-dropdown-toggle>
                <img src="https://photosking.net/wp-content/uploads/2024/05/no-dp-pic_23.webp" alt="Profile" class="img-circle" height="30">
                Admin <span class="caret"></span>
              </a>
              <ul class="dropdown-menu" uib-dropdown-menu>
                <li><a ui-sref="adminProfile">Profile</a></li>
                <li><a href ng-click="vm.logout()">Logout</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container" style="margin-top: 70px;">
      <!-- Page Header -->
      <div class="page-header">
        <div class="row">
          <div class="col-sm-8">
            <h1>Admin Analytics Dashboard</h1>
            <p class="lead">Platform Overview & Management</p>
          </div>
          <div class="col-sm-4 text-right">
            <button class="btn btn-primary" ng-click="vm.loadAnalytics()">
              <i class="glyphicon glyphicon-refresh"></i> Refresh Data
            </button>
          </div>
        </div>
      </div>

      <!-- Stats Overview using panels -->
      <div class="row">
        <!-- First Row of Stats -->
        <div class="col-sm-3">
          <div class="panel panel-primary">
            <div class="panel-heading">
              <h3 class="panel-title">Total Users</h3>
            </div>
            <div class="panel-body text-center">
              <h3>{{vm.analyticsData.totalUsers || 'N/A'}}</h3>
              <div>
                <span class="label label-info">Sellers: {{vm.analyticsData.userStats.sellers || 'N/A'}}</span>
                <span class="label label-success">Buyers: {{vm.analyticsData.userStats.buyers || 'N/A'}}</span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="panel panel-success">
            <div class="panel-heading">
              <h3 class="panel-title">Total Vehicles</h3>
            </div>
            <div class="panel-body text-center">
              <h3>{{vm.analyticsData.totalVehicles || 'N/A'}}</h3>
              <small>Most Popular: {{vm.analyticsData.mostPopular || 'N/A'}}</small>
            </div>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Total Bookings</h3>
            </div>
            <div class="panel-body text-center">
              <h3>{{vm.analyticsData.totalBookings || 'N/A'}}</h3>
              <small>Avg Duration: {{vm.analyticsData.avgBookingDuration}} days</small>
            </div>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="panel panel-warning">
            <div class="panel-heading">
              <h3 class="panel-title">Total Bids</h3>
            </div>
            <div class="panel-body text-center">
              <h3>{{vm.analyticsData.totalBids || 'N/A'}}</h3>
              <small>Rejection Rate: {{vm.analyticsData.bidRejectionRate}}%</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Second Row of Stats -->
      <div class="row">
        <div class="col-sm-4">
          <div class="panel panel-danger">
            <div class="panel-heading">
              <h3 class="panel-title">Revenue Metrics</h3>
            </div>
            <div class="panel-body">
              <p><strong>Total Revenue:</strong> ₹{{vm.analyticsData.totalRevenue || '0.00'}}</p>
              <p><strong>Avg Booking Value:</strong> ₹{{vm.analyticsData.avgBookingValue || '0.00'}}</p>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="panel panel-primary">
            <div class="panel-heading">
              <h3 class="panel-title">Listing Performance</h3>
            </div>
            <div class="panel-body">
              <p><strong>Most Queried:</strong> {{vm.analyticsData.mostQueried || 'N/A'}}</p>
              <p><strong>Avg Time to First Booking:</strong> {{vm.analyticsData.listingToFirstBooking || 'N/A'}} days</p>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="panel panel-success">
            <div class="panel-heading">
              <h3 class="panel-title">Communication Stats</h3>
            </div>
            <div class="panel-body">
              <p><strong>Total Conversations:</strong> {{vm.analyticsData.totalConversations || 'N/A'}}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section using tabset -->
      <uib-tabset class="nav-tabs-custom">
        <uib-tab heading="Growth Metrics">
          <div class="row" style="margin-top: 20px;">
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Vehicles Growth Over Time</h3>
                </div>
                <div class="panel-body">
                  <canvas id="vehiclesOverTimeChart" height="300"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">User Growth Trend</h3>
                </div>
                <div class="panel-body">
                  <canvas id="userGrowthChart" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>
        </uib-tab>
        <uib-tab heading="Performance Metrics">
          <div class="row" style="margin-top: 20px;">
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Bid vs Rental</h3>
                </div>
                <div class="panel-body">
                  <canvas id="bidVsRentalChart" height="300"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Top Booked Cars</h3>
                </div>
                <div class="panel-body">
                  <canvas id="topBookedCarsChart" height="300"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Conversations vs Bookings</h3>
                </div>
                <div class="panel-body">
                  <canvas id="convosVsBookingsChart" height="300"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Conversion Rate</h3>
                </div>
                <div class="panel-body">
                  <canvas id="conversionRateChart" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>
        </uib-tab>
        <uib-tab heading="Location & Price Analysis">
          <div class="row" style="margin-top: 20px;">
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Active Locations Distribution</h3>
                </div>
                <div class="panel-body">
                  <canvas id="activeLocationChart" height="300"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Price Competitiveness Analysis</h3>
                </div>
                <div class="panel-body">
                  <canvas id="priceCompetitivenessChart" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>
        </uib-tab>
        <uib-tab heading="Booking & Bid Analysis">
          <div class="row" style="margin-top: 20px;">
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Outstation vs Local Bookings</h3>
                </div>
                <div class="panel-body">
                  <canvas id="outstationLocalChart" height="300"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Average Booking Duration by Type</h3>
                </div>
                <div class="panel-body">
                  <canvas id="avgBookingDurationByTypeChart" height="300"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Average Bid Amount by Type</h3>
                </div>
                <div class="panel-body">
                  <canvas id="avgBidAmountByTypeChart" height="300"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Most Bidded Vehicles</h3>
                </div>
                <div class="panel-body">
                  <canvas id="mostBiddedChart" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>
        </uib-tab>
      </uib-tabset>

      <!-- Top Users Section -->
      <div class="panel panel-info" style="margin-top: 20px;">
        <div class="panel-heading">
          <h3 class="panel-title">Top 5 Users by Booking Value</h3>
        </div>
        <div class="panel-body">
          <div class="list-group">
            <div class="list-group-item" ng-repeat="user in vm.topUsers">
              <div class="row">
                <div class="col-xs-2 text-center">
                  <span class="badge">{{$index + 1}}</span>
                </div>
                <div class="col-xs-10">
                  <h4 class="list-group-item-heading">{{user.name}}</h4>
                  <p class="list-group-item-text">
                    Total Bookings: {{user.totalBookings}}<br>
                    Total Value: ₹{{user.totalValue | number:2}}
                  </p>
                </div>
              </div>
            </div>
            <div class="list-group-item text-center" ng-if="!vm.topUsers.length">
              <p>No user data available</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="text-center" ng-if="vm.someTotalPages > 1">
        <uib-pagination
          total-items="vm.someItemCount"
          ng-model="vm.currentPage"
          max-size="5"
          boundary-links="true"
          class="pagination-sm"
          previous-text="&lsaquo;"
          next-text="&rsaquo;"
          first-text="&laquo;"
          last-text="&raquo;">
        </uib-pagination>
      </div>
    </div>
  </div>
</body>