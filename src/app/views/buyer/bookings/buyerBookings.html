<app-navbar active-state="buyerBookings"></app-navbar>

<body>
    <div style="margin-top: 70px; width: 90%; height: 100%;  " class="container" ng-controller="BuyerBookingsController" ng-init="init()">
      <div class="row analytics">
        <div class="col-sm-4">
          <div class="panel panel-default">
            <div class="panel-body text-center">
              <h4>Total Bookings</h4>
              <p class="lead">{{analytics.totalBookings}}</p>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="panel panel-default">
            <div class="panel-body text-center">
              <h4>Upcoming Bookings</h4>
              <p class="lead">{{analytics.upcomingBookings}}</p>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="panel panel-default">
            <div class="panel-body text-center">
              <h4>Completed Bookings</h4>
              <p class="lead">{{analytics.completedBookings}}</p>
            </div>
          </div>
        </div>
      </div>


      <div class="filter-tabs text-center">
        <div class="btn-group">
          <button type="button" class="btn btn-default" ng-class="{active: currentView === 'confirmed'}" ng-click="changeView('confirmed')">Confirmed</button>
          <button type="button" class="btn btn-default" ng-class="{active: currentView === 'in progress'}" ng-click="changeView('in progress')">In Progress</button>
          <button type="button" class="btn btn-default" ng-class="{active: currentView === 'completed'}" ng-click="changeView('completed')">Completed</button>
        </div>
      </div>

      <div class="bookings">
        <h2 class="text-center">{{currentView | uppercase}} BOOKINGS</h2>
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>Vehicle</th>
                <th>Booking Date</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                <th>Total Amount</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="booking in bookings">
                <td>{{booking.vehicle.model || 'Unknown Vehicle'}}</td>
                <td>{{booking.booking_date | date}}</td>
                <td>{{booking.booking_start_date | date}}</td>
                <td>{{booking.booking_end_date | date}}</td>
                <td>{{booking.status}}</td>
                <td>Rs {{booking.booking_amount || '--'}}</td>
                <td>
                  <div class="btn-group">
                    <button type="button" class="btn btn-danger btn-xs" ng-if="booking.status.trim().toLowerCase() === 'confirmed'" ng-click="cancelBooking(booking)">Cancel Booking</button>
                    <button type="button" class="btn btn-info btn-xs" ng-if="booking.status.trim().toLowerCase() === 'completed'" ng-click="showReceiptModal(booking)">View Receipt</button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <script type="text/ng-template" id="receiptModalTemplate.html">
        <div class="modal-header">
          <button type="button" class="close" ng-click="closeModal()">&times;</button>
          <h4 class="modal-title">Trip Receipt</h4>
        </div>
        <div class="modal-body">
          <table class="table table-bordered">
            <tr>
              <th>Duration:</th>
              <td>{{modal.receipt.duration}}</td>
            </tr>
            <tr>
              <th>Total KM Driven:</th>
              <td>{{modal.receipt.kmDriven}}</td>
            </tr>
            <tr>
              <th>Base Price:</th>
              <td>{{modal.receipt.basePrice}}</td>
            </tr>
            <tr>
              <th>Extra Charges:</th>
              <td>{{modal.receipt.extraCharge}}</td>
            </tr>
            <tr>
              <th>Final Price:</th>
              <td>{{modal.receipt.finalPrice}}</td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" ng-click="closeModal()">Close</button>
        </div>
      </script>
    </div>
  </body>

